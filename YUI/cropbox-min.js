"use strict";YUI.add("crop-box",function(a){a.cropbox=a.Base.create("crop-box",a.Base,[],{initializer:function(b){this.options=b;this.state={};this.render()},render:function(){var b=this;this.imageBox=a.one(this.options.imageBox);this.thumbBox=this.imageBox.one(this.options.thumbBox);this.spinner=this.imageBox.one(this.options.spinner);this.initObject();return this},initObject:function(){var b=this;this.spinner.show();this.image=new Image();this.image.onload=function(){b.spinner.hide();b.setBackground();b.imageBox.on("mousedown",b.imgMouseDown,b);b.imageBox.on("mousemove",b.imgMouseMove,b);b.mouseup=a.one("body").on("mouseup",b.imgMouseUp,b);a.UA.gecko>0?b.imageBox.on("DOMMouseScroll",b.zoomImage,b):b.imageBox.on("mousewheel",b.zoomImage,b)};this.image.src=this.options.imgSrc},setBackground:function(){if(!this.ratio){this.ratio=1}var b=parseInt(this.image.width)*this.ratio;var d=parseInt(this.image.height)*this.ratio;var c=(this.imageBox.get("clientWidth")-b)/2;var e=(this.imageBox.get("clientHeight")-d)/2;this.imageBox.setAttribute("style","background-image: url("+this.image.src+"); background-size: "+b+"px "+d+"px; background-position: "+c+"px "+e+"px; background-repeat: no-repeat")},imgMouseDown:function(b){b.stopImmediatePropagation();this.state.dragable=true;this.state.mouseX=b.clientX;this.state.mouseY=b.clientY},imgMouseMove:function(f){f.stopImmediatePropagation();if(this.state.dragable){var c=f.clientX-this.state.mouseX;var h=f.clientY-this.state.mouseY;var d=this.imageBox.getStyle("backgroundPosition").split(" ");var b=c+parseInt(d[0]);var g=h+parseInt(d[1]);this.imageBox.setStyle("backgroundPosition",b+"px "+g+"px");this.state.mouseX=f.clientX;this.state.mouseY=f.clientY}},imgMouseUp:function(b){b.stopImmediatePropagation();this.state.dragable=false},zoomImage:function(b){b.wheelDelta>0?this.ratio*=1.1:this.ratio*=0.9;this.setBackground()},getDataURL:function(){var l=this,e=this.thumbBox.get("clientWidth"),k=this.thumbBox.get("clientHeight"),f=document.createElement("canvas"),h=this.imageBox.getStyle("backgroundPosition").split(" "),n=this.imageBox.getStyle("backgroundSize").split(" "),o=parseInt(h[0])-this.imageBox.get("clientWidth")/2+e/2,m=parseInt(h[1])-this.imageBox.get("clientHeight")/2+k,c=parseInt(n[0]),i=parseInt(n[1]),g=parseInt(this.image.height),j=parseInt(this.image.width);f.width=e;f.height=k;var d=f.getContext("2d");d.drawImage(this.image,0,0,j,g,o,m,c,i);var b=f.toDataURL("image/png");return b},getBlob:function(){var f=this.getDataURL();var c=f.replace("data:image/png;base64,","");var e=atob(c);var d=[];for(var b=0;b<e.length;b++){d.push(e.charCodeAt(b))}return new Blob([new Uint8Array(d)],{type:"image/png"})},zoomIn:function(){this.ratio*=1.1;this.setBackground()},zoomOut:function(){this.ratio*=0.9;this.setBackground()},destructor:function(){if(this.mouseup){this.mouseup.detach()}}})},"1.0",{requires:["node","base"]});